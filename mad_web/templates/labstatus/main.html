{% load staticfiles i18n %}
<!DOCTYPE html>
<html>
<head>
    <title>UTCS Lab Status</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="//fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Open+Sans:400,300,600" rel='stylesheet'
          type='text/css'>
    <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/js/jquery.tooltipster.min.js"></script>
    <script src="js/search.js"></script>
    <script src="js/rendering.js"></script>
    <script>
        $(function () {
            var searchField = $("#search-input");
            var machines;

            let spaces = document.getElementsByClassName("space");
            for (let i = 0; i < spaces.length; i++) {
                const element = spaces[i];
                element.style.left = element.getAttribute("data-x-percent") * 100.0 + "%";
                element.style.top = element.getAttribute("data-y-percent") * 100.0 + "%";
            }

            $(document).on("input", function (e) {
                var text = searchField.val();
                if (!machines || machines.length > 0) {
                    machines = $(".machine")
                }
                filterMachines(machines, text)
            });
            $(document).on("keypress", function (e) {
                searchField.focus()
            })
        });



    </script>

    <!-- Google Analytics -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-66239364-1', 'auto');
        ga('send', 'pageview');



    </script>

    {% block css %}
        <link href="{% static 'generated_css/labstatus.min.css' %}" rel="stylesheet">
        {% block extra-css %}{% endblock %}
    {% endblock %}
</head>
<body>
<nav>
    <div class="ion-ios-search-strong" id="search-icon"></div>
    <input type="search" placeholder="machine name" id="search-input"/>
    <div class="ion-ios-help-empty" id="help-icon"></div>
</nav>
<section id="labs">
    <div id="third-floor" class="lab">
        <div class="container">
            <h1>Third Floor</h1>
            <div class="machines-container">
                <div class="machines">
                    {% for machine in labs.0 %}
                        {% if machine.is_monitor %}
                            <div class="space monitor" data-name="{{ machine.name }}"
                                 data-x-percent="{{ machine.location.0 }}"
                                 data-y-percent="{{ machine.location.1 }}"></div>
                        {% else %}
                            <div class="space machine {{ machine.characteristics }}" data-name="{{ machine.name }}"
                                 data-occupied="{{ machine.occupied }}" data-users="{{ machine.users }}"
                                 data-x-percent="{{ machine.location.0 }}" data-y-percent="{{ machine.location.1 }}"
                            >
                            </div>
                        {% endif %}
                    {% endfor %}

                </div>
            </div>
        </div>
    </div>
    <div id="basement" class="lab">
        <div class="container">
            <h1>Basement</h1>
            <div class="machines-container">
                <div class="machines">
                    {% for machine in labs.1 %}
                        {% if machine.is_monitor %}
                            <div class="space monitor" data-name="{{ machine.name }}"
                                 data-x-percent="{{ machine.location.0 }}"
                                 data-y-percent="{{ machine.location.1 }}"></div>
                        {% else %}
                            <div class="space machine {{ machine.characteristics }}" data-name="{{ machine.name }}"
                                 data-occupied="{{ machine.occupied }}" data-users="{{ machine.users }}"
                                 data-x-percent="{{ machine.location.0 }}" data-y-percent="{{ machine.location.1 }}"
                            >
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
<footer><a href="https://github.com/utcsmad/UTCS-lab-status">
    <div class="ion-social-github"></div>
</a><a href="http://www.cs.utexas.edu/users/mad/labs/">
    <div class="mad-labs-logo"></div>
</a></footer>


<script type="text/template" id="monitorTemplate">
    <div class="space monitor" data-name="<%= data.name%>" style="left:<%=data.left%>;top:<%=data.top%>;">
    </div>
</script>
<script type="text/template" id="tooltipTemplate">
    <h3><%= data.name %></h3>
    <span> <%= data.uptime %> </span>
</script>
<script type="text/template" id="monitorTooltipTemplate">
    <h3><%= data.name %></h3>
</script>
</body>
