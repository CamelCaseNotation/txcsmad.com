{% load staticfiles i18n %}
<!DOCTYPE html>
<html>
<head>
    <title>UTCS Lab Status</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Open+Sans:400,300,600" rel='stylesheet'
          type='text/css'>
    <link href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/js/jquery.tooltipster.min.js"></script>
    <script src="js/search.js"></script>
    <script src="js/rendering.js"></script>
    <script>
        $(function () {
            var data =;
            <
            ? php echo;
            UTCS::getLabsData();
            ?
            >
            var searchField = $("#search-input");
            var machines;
            $.getJSON("third-floor.json", function (json) {
                renderLab(json, data.values[0].machines, $("#third-floor .machines"))
            });
            $.getJSON("basement.json", function (json) {
                renderLab(json, data.values[1].machines, $("#basement .machines"))
            });
            $(document).on("input", function (e) {
                var text = searchField.val();
                if (!machines || machines.length > 0) {
                    machines = $(".machine")
                }
                filterMachines(machines, text)
            });
            $(document).on("keypress", function (e) {
                searchField.focus()
            })
        });
    </script>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Google Analytics -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-66239364-1', 'auto');
        ga('send', 'pageview');
    </script>

    {% block css %}
        <link href="{% static 'css/labstatus.min.css' %}" rel="stylesheet">
        {% block extra-css %}{% endblock %}
    {% endblock %}
</head>
<body>
<nav>
    <div class="ion-ios-search-strong" id="search-icon"></div>
    <input type="search" placeholder="machine name" id="search-input"/>
    <div class="ion-ios-help-empty" id="help-icon"></div>
</nav>
<section id="labs">
    <div id="third-floor" class="lab">
        <div class="container">
            <h1>Third Floor</h1>
            <div class="machines-container">
                <div class="machines"></div>
            </div>
        </div>
    </div>
    <div id="basement" class="lab">
        <div class="container">
            <h1>Basement</h1>
            <div class="machines-container">
                <div class="machines"></div>
            </div>
        </div>
    </div>
</section>
<footer><a href="https://github.com/utcsmad/UTCS-lab-status">
    <div class="ion-social-github"></div>
</a><a href="http://www.cs.utexas.edu/users/mad/labs/">
    <div class="mad-labs-logo"></div>
</a></footer>

<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js" type="text/javascript"></script>

<script type="text/template" id="machineTemplate">
    <% var classes = data.occupied ? "occupied": ""
    classes += (data.users > 4) ? " heavy-use" : "" %>
    <div class="space machine <%= classes%>" data-name="<%= data.name%>" data-occupied="<%= data.occupied %>"
         data-users="<%= data.users %>" style="left:<%=data.left%>;top:<%=data.top%>;">
    </div>
</script>

<script type="text/template" id="monitorTemplate">
    <div class="space monitor" data-name="<%= data.name%>" style="left:<%=data.left%>;top:<%=data.top%>;">
    </div>
</script>
<script type="text/template" id="tooltipTemplate">
    <h3><%= data.name %></h3>
    <span> <%= data.uptime %> </span>
</script>
<script type="text/template" id="monitorTooltipTemplate">
    <h3><%= data.name %></h3>
</script>
</body>
